name: "Johweb Ansible CaC Workflow"
on:
  push:
    branches:
      - infra-staging
    paths:
      - ansible/main-playbook.yml
env:
  TF_VAR_the_key: ${{ secrets.TF_VAR_THE_KEY }}
  WEBSRV_USR: WEBSRV_USR
  ECR_ENDPOINT: ECR_ENDPOINT
  host_ip: HOST_IP

jobs:
  Ansible:
    name: "Dry run Anisble Playbook"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Source Code
        uses: actions/checkout@v2

      - name: Run Ansible Playbook
        uses: dawidd6/action-ansible-playbook@v2
        with:
          playbook: ansible/main-playbook.yml
          key: ${{secrets.TF_VAR_THE_KEY}}
          inventory: |
            all:
              hosts:
                johweb-ec2-pub1:
                  ansible_host: $HOST_IP
                  ansible_user: $WEBSRV_USR
          options:  |
            --check
